---
title: "Alfredå¿«é€Ÿåœ¨iTerm2å’Œtmux sessionä¸­æ‰§è¡Œå‘½ä»¤"
date: "2025-05-20"
description: "Aflredé›†æˆiTerm2å’Œtmux"
categories: ['tools']
draft: false
format:
  html:
    code-overflow: wrap
---

[è¿™ä¸ªAppleScript](https://github.com/vitorgalvao/custom-alfred-iterm-scripts)å¯ä»¥è®©Alfredç›´æ¥åœ¨iTerm2ä¸­æ‰§è¡Œshellå‘½ä»¤ï¼ˆé»˜è®¤æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„Tminal.appï¼‰

é€šè¿‡Alfredæ‰§è¡Œçš„shellå‘½ä»¤ï¼Œä¼šåœ¨æ–°çš„iTerm2 Tabä¸­æ‰§è¡Œã€‚

æˆ‘æ›´ä¹ æƒ¯åœ¨tmuxçš„sessionä¸­è¿›è¡Œæ–°çš„å‘½ä»¤éªŒè¯ï¼Œäºæ˜¯å°±è®©chatGPTå¸®äº†ä¸€ä¸ªå°å¿™ï¼š

åœ¨iTerm2å®ä¾‹å’Œtmux-serveréƒ½åœ¨è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡Alfredä¼ é€çš„å‘½ä»¤ä¼šåœ¨æ–°çš„tmux-sessionä¸­æ‰§è¡Œï¼Œè€Œä¸æ˜¯iTerm2çš„Tabä¸­ï¼š

![](https://image.luozx.org/garden/2025/05/c2b4e43bbfc7eaa72d4432022ed5ec76.gif)

![](https://image.luozx.org/garden/2025/05/137ce0efc04ef55666c4c19e72853e33.png)

å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶åˆ°Alfredä¸­ï¼Œå°±å¯ä»¥äº†ã€‚

::: {.callout-important}
å¦‚æœneovimè¿è¡Œåœ¨tmuxçš„paneä¸­ï¼Œæ­¤æ—¶æ‰§è¡Œalfredä¼šå†²çªã€‚
:::

<details>
<summary>æ˜¾ç¤ºä»£ç </summary>

```bash
-- For the latest version:
-- https://github.com/vitorgalvao/custom-alfred-iterm-scripts

property open_in_new_window : false   -- Always open a new iTerm window
property open_in_new_tab    : true    -- Re-use iTerm but open a new tab
property iterm_opens_quietly : false  -- iTerm launches without a new window

-- â¬‡ï¸  Added: detect if the current session is inside tmux
on in_tmux()
  try
    tell application "iTerm" to tell current session of current tab of current window
      set tmuxEnv to variable named "TMUX"
    end tell
    return tmuxEnv is not ""
  on error
    return false
  end try
end in_tmux

-- Handlers -------------------------------------------------------------
on new_window()
  tell application "iTerm" to create window with default profile
end new_window

on new_tab()
  tell application "iTerm" to tell the first window to create tab with default profile
end new_tab

on call_forward()
  tell application "iTerm" to activate
end call_forward

on is_running()
  application "iTerm" is running
end is_running

on is_processing()
  tell application "iTerm" to tell the first window to tell current session to return is processing
end is_processing

on has_windows()
  if not is_running() then return false

  tell application "iTerm"
    if windows is {} then return false
    if tabs of current window is {} then return false
    if sessions of current tab of current window is {} then return false

    set session_text to contents of current session of current tab of current window
    if words of session_text is {} then return false
  end tell

  true
end has_windows

on send_text(custom_text)
  tell application "iTerm" to tell the first window to tell current session to write text custom_text
end send_text

-- Main -----------------------------------------------------------------
on alfred_script(query)
  if has_windows() then
    if open_in_new_window then
      new_window()
    else if in_tmux() then
      -- ğŸ‘‰ Already inside tmux: create a new tmux window instead of a new iTerm tab
      send_text("tmux new-window")
      delay 0.1 -- brief pause so the new window becomes active
    else if open_in_new_tab then
      new_tab()
    else
      -- Re-use current tab
    end if
  else
    -- iTerm is closed or has no usable windows
    if is_running() or iterm_opens_quietly then
      new_window()
    else
      call_forward()
    end if
  end if

  -- If query is >1024 bytes wait until session finishes processing previous input
  if length of query > 1024 then
    repeat 500 times -- 5 s timeout
      if not is_processing() then exit repeat
      delay 0.01
    end repeat
  end if

  -- Wait for a window to exist before writing, or the write may fail
  repeat 500 times -- 5 s timeout
    if has_windows() then
      send_text(query)
      call_forward()
      exit repeat
    end if
    delay 0.01
  end repeat
end alfred_script

```
</details>
